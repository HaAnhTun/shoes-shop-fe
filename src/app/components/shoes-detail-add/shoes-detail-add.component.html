<div class="surface-section">
    <p-toast></p-toast>
    <div class="font-medium text-3xl text-900 mb-3">Thêm mới sản phẩm chi tiết</div>
    <div class="text-500 mb-5">Thông tin cơ bản</div>
    <form [formGroup]="formGroup">
        <ul class="list-none p-0 m-0">
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                <div class="text-500 w-2 md:w-2 font-medium">Tên giày</div>
                <div class="text-800 w-full md:w-8 md:flex-order-0 flex-order-1">
                    <span class="p-float-label">
                        <p-autoComplete showClear="true" autofocus="true" showEmptyMessage="true" unique="true"
                            autoHighlight="true" required="true" id="float-input-shoes" forceSelection="true"
                            formControlName="shoes" [dropdown]="true"
                            (completeMethod)="filterList($event,shoes,'shoes')" [suggestions]="filteredShoes"
                            [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}" field="name"></p-autoComplete>
                        <label for="float-input-shoes">Sản Phẩm</label>
                    </span>
                </div>
            </li>
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                <div class="text-500 w-2 md:w-2 font-medium">Thương hiệu</div>
                <div class="text-800 w-full md:w-8 md:flex-order-0 flex-order-1">
                    <span class="p-float-label">
                        <p-autoComplete showClear="true" showEmptyMessage="true" unique="true" autoHighlight="true"
                            required="true" id="float-input-shoes" forceSelection="true" formControlName="brand"
                            [dropdown]="true" (completeMethod)="filterList($event,brands,'brands')"
                            [suggestions]="filteredBrands" [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}"
                            field="name"></p-autoComplete>
                        <label for="float-input-shoes">Brand</label>
                    </span>
                </div>
            </li>
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                <div class="text-500 w-2 md:w-2 font-medium">Giá Nhập Default</div>
                <div class="text-800 w-2 md:w-2 md:flex-order-0 flex-order-1">
                    <span class="p-float">
                        <p-inputNumber id="p-float" formControlName="import_price" inputId="currency-vn" mode="currency"
                            currency="VND" styleClass="w-full" ocale="vi-VN" max="999999999"> </p-inputNumber>
                    </span>
                </div>
                <div class="text-500 w-1 md:w-1 font-medium">Giá Bán Default</div>
                <div class="text-800 w-full md:w-2 md:flex-order-0 flex-order-1">
                    <span class="p-float">
                        <p-inputNumber id="p-float" formControlName="price" inputId="currency-vn" mode="currency"
                            currency="VND" styleClass="w-full" locale="vi-VN" max="999999999"> </p-inputNumber>
                    </span>
                </div>
                <div class="text-500 w-1 md:w-3rem font-medium">Thuế</div>
                <div class="text-800 w-full md:w-1 md:flex-order-0 flex-order-1">
                    <span class="p-float">
                        <p-inputNumber id="p-float" formControlName="tax" inputId="currency-vn" mode="currency"
                            currency="VND" styleClass="w-full" locale="vi-VN" max="999999999"> </p-inputNumber>
                    </span>
                </div>
            </li>
            <li class="flex align-items-center py-3 px-2 border-top-1 border-bottom-1 surface-border flex-wrap">
                <div class="text-500 w-6 md:w-2 font-medium">Mô tả</div>
                <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1 line-height-3">
                    <span class="p-float-label">
                        <textarea id="float-input-summary" formControlName="description" [autoResize]="true" rows="1"
                            cols="130" maxlength="255" pInputTextarea></textarea>
                        <label for="float-input-summary">Summary</label>
                    </span>
                </div>
            </li>
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                <div class="text-500 w-6 md:w-2 font-medium">Hiển thị</div>
                <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1">

                    <p-inputSwitch formControlName="checked"></p-inputSwitch>
                </div>
            </li>
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                <div class="text-500 w-2 md:w-2 font-medium">Size</div>
                <div class="text-800 w-full md:w-8 md:flex-order-0 flex-order-1">
                    <span class="p-float-label">
                        <p-autoComplete showClear="true" showEmptyMessage="true" unique="true" autoHighlight="true"
                            required="true" class="p-fluid" id="float-input-shoes" (ngModel)="selectedSizes"
                            formControlName="size" [dropdown]="true" [multiple]="true"
                            (completeMethod)="filterList($event,sizes,'sizes')" [suggestions]="filteredSizes"
                            [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}" field="name"></p-autoComplete>
                        <label for="float-input-shoes">Sizes</label>
                    </span>
                </div>

            </li>

            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                <div class="text-500 w-2 md:w-2 font-medium">Màu sắc</div>
                <div class="text-800 w-full md:w-8 md:flex-order-0 flex-order-1">
                    <span class="p-float-label">
                        <p-autoComplete showClear="true" showEmptyMessage="true" unique="true" autoHighlight="true"
                            required="true" class="p-fluid" id="float-input-shoes" forceSelection="true"
                            formControlName="color" [dropdown]="true" [multiple]="true"
                            (completeMethod)="filterList($event,colors,'colors')" [suggestions]="filteredColors"
                            [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}" field="name"></p-autoComplete>
                        <label for="float-input-shoes">Colors</label>
                    </span>
                </div>
            </li>
            <div class="card flex justify-content-center">
                <button (click)="showTable()" pButton pRipple label="Generate Variants"
                    class="p-button-success"></button>
            </div>
        </ul>


        <div *ngIf="displayTable">
            <p-toolbar styleClass="mb-4 gap-2">
                <ng-template pTemplate="left">
                    <button pButton pRipple label="New" icon="pi pi-plus" class="p-button-success mr-2"
                        (click)="openNew()"></button>
                    <button pButton pRipple [label]="Delete" icon="pi pi-trash" class="p-button-danger"
                        (click)="deleteSelectedProducts()"
                        [disabled]="!selectedProducts || !selectedProducts.length"></button>
                </ng-template>

                <ng-template pTemplate="right">

                </ng-template>
            </p-toolbar>
            <p-table #dt [value]="shoeVariants" [rows]="5" [paginator]="true" [rowsPerPageOptions]="[5, 10, 15]"
                [globalFilterFields]="['shoes.name', 'code']" [tableStyle]="{ 'min-width': '75rem' }"
                [(selection)]="selectedProducts" [rowHover]="true" dataKey="id"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                [showCurrentPageReport]="true">
                <ng-template pTemplate="caption">
                    <div class="flex align-items-center justify-content-between">
                        <h5 class="m-0">Chi Tiết Sản Phẩm</h5>
                        <span class="p-input-icon-left">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
                                placeholder="Nhập tên sản phẩm..." />
                        </span>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 4rem">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="code">Code <p-sortIcon field="code"></p-sortIcon></th>
                        <th pSortableColumn="color.name" style="min-width:15rem">Tên Sản Phẩm <p-sortIcon
                                field="shoes.name"></p-sortIcon>
                        </th>
                        <th pSortableColumn="tax" style="min-width:10rem">Thuế <p-sortIcon field="tax"></p-sortIcon>
                        <th pSortableColumn="import_price" style="min-width:10rem">Giá Nhập(VNĐ) <p-sortIcon
                                field="import_price"></p-sortIcon>
                        <th pSortableColumn="price" style="min-width:10rem">Giá Bán(VNĐ) <p-sortIcon
                                field="price"></p-sortIcon>
                        <th pSortableColumn="quantity" style="min-width:10rem">Số Lượng(đôi) <p-sortIcon
                                field="quantity"></p-sortIcon>
                        <th pSortableColumn="status" style="min-width:10rem">Trạng Thái <p-sortIcon
                                field="status"></p-sortIcon>
                        </th>
                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-product>
                    <tr>
                        <td>
                            <p-tableCheckbox [value]="product"></p-tableCheckbox>
                        </td>
                        <td>{{ product.code }}</td>
                        <td>{{ product.shoes.name }} [{{product.color.name}} - {{product.size.name}}]</td>
                        <td>{{ product.tax | currency : 'VND' }}</td>
                        <td>{{ product.import_price | currency : 'VND' }}</td>
                        <td>{{ product.price | currency : 'VND' }}</td>
                        <td>{{ product.quantity }}</td>
                        <td>
                            <p-tag [value]="getStatus(product.status)" [severity]="getSeverity(product.status)"></p-tag>
                        </td>
                        <td>
                            <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2"
                                (click)="editProduct(product)"></button>
                            <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger"
                                (click)="deleteProduct(product)"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="summary">
                    <div class="flex align-items-center justify-content-between">In total there are {{ shoevariants ?
                        shoevariants.length : 0 }} products.</div>
                </ng-template>
            </p-table>
            <p-dialog [(visible)]="productDialog" [style]="{ width: '450px' }" header="Product Details" [modal]="true"
                styleClass="p-fluid">
                <ng-template pTemplate="content">
                    <label for="name">Name</label>
                    <input type="text" pInputText id="name" [(ngModel)]="product.name" required autofocus />
                    <small class="p-error" *ngIf="submitted && !product.name">Name is required.</small>
                    <div class="field">
                    </div>
                    <div class="field">
                        <label for="status">Status</label>
                        <p-dropdown appendTo="body" [(ngModel)]="product.status" inputId="status" [virtualScroll]="true"
                            [options]="statuses">
                            <ng-template pTemplate="selectedItem">
                                <p-tag [value]="getStatus(product.status)"
                                    [severity]="getSeverity(product.status)"></p-tag>
                            </ng-template>
                            <ng-template let-option pTemplate="item">
                                <p-tag [value]="option.label" [severity]="getSeverity(option.value)"></p-tag>
                            </ng-template>
                        </p-dropdown>
                    </div>
                </ng-template>

                <ng-template pTemplate="footer">
                    <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text"
                        (click)="hideDialog()"></button>
                    <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text"
                        (click)="saveProduct()"></button>
                </ng-template>
            </p-dialog>
            <p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
            <p-messages></p-messages>
        </div>


    </form>
</div>